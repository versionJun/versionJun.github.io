<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Termux+Docker - versionjun.github.io</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="https://versionjun.github.io/">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././assets/css/variables.css">
        <link rel="stylesheet" href=".././assets/css/general.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Software</li><li class="chapter-item expanded "><a href="../Software/Windows-Software.html"><strong aria-hidden="true">1.</strong> Windows-Software</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Software/nodejs.html"><strong aria-hidden="true">1.1.</strong> nodejs</a></li></ol></li><li class="chapter-item expanded "><a href="../Software/Android-Software.html"><strong aria-hidden="true">2.</strong> Android-Software</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Software/Termux+QEMU+linux_alpine+Docker.html" class="active"><strong aria-hidden="true">2.1.</strong> Termux+Docker</a></li></ol></li><li class="chapter-item expanded "><a href="../Software/Linux-Software.html"><strong aria-hidden="true">3.</strong> Linux-Software</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Software/Linux-Command.html"><strong aria-hidden="true">3.1.</strong> Command</a></li></ol></li><li class="chapter-item expanded "><li class="part-title"></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">杂谈</li><li class="chapter-item expanded "><a href="../杂谈/黑炮事件.html"><strong aria-hidden="true">4.</strong> 黑炮事件</a></li><li class="chapter-item expanded "><a href="../杂谈/我们都无法成为大人.html"><strong aria-hidden="true">5.</strong> 我们都无法成为大人</a></li><li class="chapter-item expanded affix "><li class="part-title"></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../About/mdbook-site.html">About</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">versionjun.github.io</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/versionJun/versionJun.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/versionJun/versionJun.github.io/edit/main/src/Software/Termux+QEMU+linux_alpine+Docker.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="termux--qemu--linux_alpine--docker"><a class="header" href="#termux--qemu--linux_alpine--docker">Termux + QEMU + linux_alpine + Docker</a></h1>
<h2 id="准备工作"><a class="header" href="#准备工作">准备工作</a></h2>
<ol>
<li>
<p>Termux <sup>[<a href="https://github.com/termux/termux-app/releases">Github</a>]</sup><sup>[<a href="https://f-droid.org/zh_Hans/packages/com.termux/">F-Droid</a>]</sup></p>
</li>
<li>
<p>Alpine Linux系统镜像</p>
<p>Small. Simple. Secure.
Alpine Linux is a security-oriented, lightweight Linux distribution based on musl libc and busybox.
(来自<a href="https://alpinelinux.org/">https://alpinelinux.org/</a>)</p>
<p>使用Alpine的原因：</p>
<ul>
<li>体积占用小，完全安装后的镜像不到1gb</li>
<li>安装快 <s>(废话)</s></li>
<li>内存占用小，idle状态仅占用30多MB内存</li>
</ul>
<p>传送门：</p>
<p>virtual-x86_64: <a href="http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-virt-3.10.1-x86_64.iso">alpine-virt-3.10.1-x86_64.iso(v3.10.1, OfficialSite)</a></p>
</li>
</ol>
<h2 id="详细过程"><a class="header" href="#详细过程">详细过程</a></h2>
<ol>
<li>
<p>安装依赖</p>
<p>在Termux中：</p>
<pre><code class="language-bash">
pkg install x11-repo unstable-repo

pkg install qemu-utils qemu-common qemu-system-x86_64


</code></pre>
</li>
<li>
<p>创建虚拟镜像(硬盘)</p>
<p>在Termux中：</p>
<pre><code class="language-bash">
qemu-img create -f qcow2 alpine.img 8G


</code></pre>
<blockquote>
<p>参数中8G代表创建一个最大容量为8G的镜像，可调节，最少2g以保证docker能正常安装。</p>
</blockquote>
</li>
<li>
<p>下載Alpine Linux系统镜像</p>
<p>在Termux中：</p>
<pre><code class="language-bash">
mkdir alpine &amp;&amp; cd $_
wget http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-virt-3.10.1-x86_64.iso


</code></pre>
</li>
<li>
<p>Alpine安装到虚拟硬盘</p>
<p>在Termux中：</p>
<pre><code class="language-bash">
qemu-system-x86_64 -machine q35 -m 1024 -smp cpus=2 -cpu qemu64 \
    -drive if=pflash,format=raw,read-only=on,file=$PREFIX/share/qemu/edk2-x86_64-code.fd \
    -netdev user,id=n1,hostfwd=tcp::2222-:22 -device virtio-net,netdev=n1 \
    -cdrom alpine-virt-3.10.1-x86_64.iso \
    -nographic alpine.img

</code></pre>
<blockquote>
<p>可另存为setup.sh, 赋予权限<code>chmod +x setup.sh</code>, 调用<code>./setup.sh</code></p>
</blockquote>
<p>参数解释：</p>
<ul>
<li>-hda : 启动的虚拟硬盘</li>
<li>-cdrom : 启动的光盘镜像文件(相当于用光盘安装windows)</li>
<li>-boot : 启动槽位，选d (我也不是太清楚)</li>
<li>-m : 内存大小，单位mb</li>
<li>-nographic : 无图像模式，直接在控制台输出</li>
<li>--vnc :1 : 以vnc为图像模式输出到”显示器”，并占用vnc 1端口</li>
</ul>
</li>
<li>
<p>使用root帳號登入，啟用網路卡</p>
<p>在Termux &gt; alpine 中：</p>
<pre><code class="language-bash">
setup-interfaces

#Available interfaces are: eth0.

#Enter '?' for help on bridges, bonding and vlans.

#Which one do you want to initialize? (or '?' or 'done') [eth0]

#Ip address for eth0? (or 'dhcp', 'none', '?') [dhcp]

#Do you want to do any manual network configuration? [no]

ifup eth0


</code></pre>
<p>在Termux &gt; alpine 中：</p>
<pre><code class="language-bash">
#在alpine中，可使用vi编辑器，查看网络配置
vi /etc/network/interfaces

#重启网络
/etc/init.d/networking restart

#修复默认dns服务器异常 将10.0.2.3改为8.8.8.8即可
vi /etc/resolv.conf


</code></pre>
</li>
<li>
<p>安装配置Alpine</p>
<p>在Termux &gt; alpine 中：</p>
<pre><code class="language-bash">
setup-alpine


</code></pre>
<p>详细配置：</p>
<ul>
<li><code>Select keyboard layout: cn</code> (选择CN键盘布局)</li>
<li><code>Select variant</code> (cn)</li>
<li><code>Enter system hostname: demohostname</code> (输入hostname名称，随意)</li>
<li><code>Which one do you want to initialize? (or '?' or 'done')</code> [eth0]</li>
<li><code>Ip address for eth0? (or 'dhcp', 'none', '?') [10.0.2.15] dhcp</code> (选dhcp)</li>
<li><code>Changing password for root</code> (修改root用户密码)</li>
<li><code>Which timezone are you in? ('?' for list) [UTC] Asia/Shanghai</code> (时区填Asia/Shanghai)</li>
<li><code>HTTP/FTP proxy URL? (e.g. 'http://proxy:8080', or 'none') [none]</code> (代理地址，默认none)</li>
<li><code>Enter mirror number (1-47) or URL to add (or r/f/e/done) [f]: 14</code> (选择软件源，14(清华源:http://mirrors.tuna.tsinghua.edu.cn/))</li>
<li><code>Which SSH server? ('openssh', 'dropbear' or 'none') [openssh]</code> (SSH服务器，选择openssh(默认))</li>
<li><code>Which disk(s) would you like to use? (or '?' for help or 'none') [none]sda</code> (安装在何处，选sda)</li>
<li><code>How would you like to use it? ('sys', 'data', 'lvm' or '?' for help) [?] sys</code> (安装方式，选sys)</li>
<li><code>WARNING: Erase the above disk(s) and continue? [y/N]: y</code> (清除整个硬盘，y(是))</li>
</ul>
<p>安装完成，关闭虚拟机</p>
<p>在Termux &gt; alpine 中：</p>
<pre><code class="language-bash">
#讓開機時能輸出訊息
sed -i -E 's/(local kernel_opts)=.*/\1=&quot;console=ttyS0&quot;/' /sbin/setup-disk

poweroff

</code></pre>
</li>
<li>
<p>启动Alpine</p>
<p>在Termux中：</p>
<pre><code class="language-bash">
qemu-system-x86_64 -machine q35 -m 2048 -smp cpus=2 -cpu qemu64 \
    -drive if=pflash,format=raw,read-only=on,file=$PREFIX/share/qemu/edk2-x86_64-code.fd \
    -netdev user,id=n1,hostfwd=tcp::2222-:22,hostfwd=tcp::8081-:80 -device virtio-net,netdev=n1 \
    -nographic alpine.img
#m是分配2GB記憶體，cpu是2核CPU，hostfwd則是把手機8081通訊埠轉發到虛擬機的80通訊埠。


</code></pre>
<blockquote>
<p>可另存为run.sh, 赋予权限<code>chmod +x run.sh</code>, 调用<code>./run.sh</code></p>
</blockquote>
<p>参数解释：</p>
<ul>
<li>-hda : 启动的虚拟硬盘</li>
<li>-boot : 启动槽位，选c (我也不是太清楚)</li>
<li>-m : 内存大小，单位mb</li>
<li>-netdev : 网络配置，详情请看 <a href="https://wiki.qemu.org/Documentation/Networking">QEMU_Wiki:Documentation/Networking</a></li>
<li>-device : 设备配置(当前指向网络设备)</li>
<li>-nographic : 无图像模式，直接在控制台输出</li>
<li>--vnc :1 : 以vnc为图像模式输出到”显示器”，并占用vnc 1端口</li>
</ul>
</li>
<li>
<p>配置SSHD</p>
<p>在Termux &gt; alpine 中：</p>
<pre><code class="language-bash">
#修改sshd_config，取消注释PermitRootLogin并修改为yes
vi /etc/ssh/sshd_config

#重启sshd
service sshd restart

</code></pre>
<p>现在外部ssh就可以登录alpine的root账户了
在Termux中：</p>
<pre><code class="language-bash">
ssh root@localhost -p 2222

</code></pre>
</li>
<li>
<p>安装Docker</p>
<p>在Termux &gt; alpine 中：</p>
<pre><code class="language-bash">
#在alpine中，docker在其comminuty源里
#添加community源,即取消注释comminuty源
vi /etc/apk/repositories

apk update  

#安装docker
apk add docker

#使docker开机启动
rc-update add docker

#开启docker服务
service docker start

#后台启动
setsid dockerd

#测试
docker info

</code></pre>
</li>
<li>
<p>Docker换源</p>
<p>在Termux &gt; alpine 中：</p>
<pre><code class="language-bash">vi /etc/docker/daemon.json

</code></pre>
<p>镜像仓库</p>
<ul>
<li>Docker 官方中国区：https://registry.docker-cn.com</li>
<li>网易：http://hub-mirror.c.163.com</li>
<li>中国科技大学：https://docker.mirrors.ustc.edu.cn</li>
<li>阿里云：https://pee6w651.mirror.aliyuncs.com</li>
</ul>
<pre><code>{
    &quot;registry-mirrors&quot;:[&quot;https://pee6w651.mirror.aliyuncs.com&quot;]
}

</code></pre>
</li>
</ol>
<h2 id="参考资料"><a class="header" href="#参考资料">参考资料：</a></h2>
<ul>
<li><a href="https://stageguard.top/2019/08/15/run-docker-on-qemu-alpine/">https://stageguard.top/2019/08/15/run-docker-on-qemu-alpine/</a></li>
<li><a href="https://ivonblog.com/posts/run-docker-in-qemu-android/">https://ivonblog.com/posts/run-docker-in-qemu-android/</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Software/Android-Software.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../Software/Linux-Software.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Software/Android-Software.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../Software/Linux-Software.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
